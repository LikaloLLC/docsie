# Объяснение работы скриптов Docsie

## Основная система сборки

### build_multilingual.sh
**Главный скрипт для многоязычной сборки**

Этот скрипт управляет всем процессом перевода и генерации сайта:

1. **Извлечение строк** (`--translate` или `--force`)
   - Извлекает переводимые строки из шаблонов в `src/`
   - Создает файл `locale/messages.pot`
   - Обновляет `.po` файлы для каждого языка

2. **Перевод через API** 
   - Использует Claude API для перевода недостающих строк
   - Кеширует переводы чтобы не переводить повторно

3. **Компиляция переводов**
   - Компилирует `.po` файлы в бинарные `.mo` файлы
   - Исправляет ошибки форматирования

4. **Генерация сайта**
   - Генерирует основной сайт через `main.py`
   - Генерирует дополнительные страницы
   - Создает многоязычные версии

**Использование:**
```bash
sh build_multilingual.sh              # Быстрая сборка (без переводов)
sh build_multilingual.sh --translate  # С переводами
sh build_multilingual.sh --force      # Полная пересборка
sh build_multilingual.sh --fix        # Исправить ошибки переводов
```

### main.py
**Главный генератор сайта**

- Использует staticjinja для генерации HTML из Jinja2 шаблонов
- Загружает RSS фиды блога и YouTube видео
- Обрабатывает V1 и V2 версии страниц
- Генерирует `index.html` из `index_v2.html`
- Запускает предварительные задачи (оптимизация изображений)

### supplementary_site_generator.py
**Генератор дополнительных страниц**

- Читает YAML файлы из `supplementary_content/`
- Генерирует страницы решений (solutions)
- Создает страницы по категориям (AI, API документация и т.д.)
- Добавляет правильные canonical URL и мета-теги

### generate_all_languages.py
**Генератор многоязычных версий**

- Создает версии основных страниц для всех языков
- Копирует структуру из английской версии
- Применяет переводы из `.mo` файлов
- Сохраняет в папки языков (`/ru/`, `/de/`, `/es/` и т.д.)

### generate_supplementary_multilingual.py
**Многоязычный генератор дополнительных страниц**

- Переводит дополнительные страницы на все языки
- Использует переведенные YAML файлы
- Создает структуру папок для каждого языка

## Система переводов

### translation_system.py
**Основная система переводов**

- Управляет переводами через Claude API
- Кеширует переводы в `.cache/translations/`
- Поддерживает пакетные переводы
- Обрабатывает контекст и форматирование

### yaml_translator_mt.py
**Многопоточный переводчик YAML**

- Переводит YAML файлы параллельно
- Использует кеширование для скорости
- Сохраняет структуру YAML
- Создает переведенные файлы в `supplementary_content/{lang}/`

### extract_yaml_strings.py
**Извлечение строк из YAML**

- Извлекает переводимые строки из YAML файлов
- Добавляет их в `locale/messages.pot`
- Помогает переводить контент из YAML

## Вспомогательные скрипты

### generate_pricing_html.py
**Генератор HTML для страницы цен**

- Читает конфигурацию цен из YAML
- Генерирует HTML таблицы цен
- Создает переключатели валют
- Обновляет страницу pricing_v2

### clean_translations.py
**Очистка файлов переводов**

- Исправляет ошибки форматирования в `.po` файлах
- Удаляет неправильные флаги python-format
- Исправляет несоответствие плейсхолдеров

### utils/build_helper.py
**Вспомогательные задачи сборки**

- Оптимизирует изображения
- Минифицирует CSS/JS
- Выполняет предварительные проверки

### utils/image_generator.py
**Генератор изображений с DALL-E**

- Создает недостающие изображения через OpenAI
- Поддерживает разные стили и качество
- Автоматически генерирует изображения для страниц

## Рабочий процесс

1. **Разработка**
   - Редактируйте шаблоны в `src/`
   - Добавляйте `{% trans %}` теги для новых строк
   - Редактируйте YAML в `supplementary_content/`

2. **Перевод**
   - Запустите `sh build_multilingual.sh --translate`
   - Скрипт извлечет строки и переведет их

3. **Сборка**
   - Запустите `sh build_multilingual.sh`
   - Сайт будет сгенерирован со всеми языками

4. **Проверка**
   - Запустите `sh start.sh` для локального сервера
   - Проверьте переводы на разных языках

5. **Исправление ошибок**
   - Используйте `sh build_multilingual.sh --fix`
   - Исправляет дубликаты и ошибки форматирования

## Структура папок

```
/
├── src/                    # Исходные шаблоны
├── locale/                 # Файлы переводов
│   ├── messages.pot       # Шаблон строк
│   └── ru/LC_MESSAGES/    # Русские переводы
├── supplementary_content/  # YAML контент
├── .cache/translations/    # Кеш переводов
├── ru/                    # Сгенерированный русский сайт
├── de/                    # Сгенерированный немецкий сайт
└── ...                    # Другие языки
```

## Важные замечания

- **Кеширование**: Переводы кешируются чтобы экономить API вызовы
- **Флаг --force**: Используйте только когда нужно перевести заново
- **Ошибки компиляции**: Нормально если есть предупреждения о форматировании
- **Порядок генерации**: Сначала английский, потом другие языки